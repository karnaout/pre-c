import{r as s,o as F,w as O,z as V,A as L,j as r,u as W,v as $,S as B,y as E,T as Z,I as N,B as I}from"./index-CZCi8_lK.js";import{r as R}from"./createSvgIcon-CnUINSrS.js";import{C as J}from"./Container-3yni4-w9.js";import{A as j}from"./Alert-CJmfXbd5.js";import{T as k}from"./TextField-B-qmQ5jv.js";import{I as G}from"./InputAdornment-CvykBIie.js";import{F as H}from"./FormControlLabel-Dw-DhQkK.js";import{C as K}from"./Checkbox-CUrsDD44.js";import"./SwitchBase-jup12wBb.js";const Q=()=>{const[o,c]=s.useState(!1),[n,d]=s.useState(null),[l,p]=s.useState(null),m=F();return{login:async(g,f)=>{c(!0),d(null);try{const t=g.toLowerCase().trim(),e=await O.post("https://precrohn-api-production.up.railway.app/api/auth/login",{email:t,password:f},{headers:{"Content-Type":"application/json"},maxBodyLength:1/0}),{token:i,user:x}=e.data;m(V({token:i,user:x})),p({status:e.status,data:e.data})}catch(t){d(t.response?t.response.data:t.message)}finally{c(!1)}},loading:o,error:n,data:l}};var b={},U=L;Object.defineProperty(b,"__esModule",{value:!0});var T=b.default=void 0,X=U(R()),Y=r;T=b.default=(0,X.default)((0,Y.jsx)("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}),"Visibility");var w={},ee=L;Object.defineProperty(w,"__esModule",{value:!0});var q=w.default=void 0,re=ee(R()),te=r;q=w.default=(0,re.default)((0,te.jsx)("path",{d:"M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7M2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2m4.31-.78 3.15 3.15.02-.16c0-1.66-1.34-3-3-3z"}),"VisibilityOff");const me=()=>{const[o,c]=s.useState(""),[n,d]=s.useState(""),[l,p]=s.useState(!1),[m,u]=s.useState(""),{login:g,loading:f,error:t,data:e}=Q(),i=W(),x=F(),{loading:z,error:h,success:S,userRole:v}=$(),D=()=>{if(u(""),!o||!n){u("Please fill in all required fields.");return}if(!/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(o)){u("Please enter a valid email address.");return}g(o,n)};return s.useEffect(()=>{var a,C,P,_,A;if(e&&e.status===200){let y={};try{typeof((a=e==null?void 0:e.data)==null?void 0:a.form)=="string"?y=JSON.parse((C=e==null?void 0:e.data)==null?void 0:C.form):typeof((P=e==null?void 0:e.data)==null?void 0:P.form)=="object"?y=(_=e==null?void 0:e.data)==null?void 0:_.form:console.error("Invalid form_data:",(A=e==null?void 0:e.data)==null?void 0:A.form),x(B({data:y}))}catch(M){console.error("there is non data",M)}}else e&&u("Login failed. Please check your credentials.")},[e,i]),s.useEffect(()=>{console.log("state:",v.state),S&&(v.role==="1"?i("/dashboard"):(v.state,i("/profile")))},[S]),z?r.jsx(E,{sx:{mt:8}}):r.jsxs(J,{component:"main",maxWidth:"xs",sx:{display:"flex",flexDirection:"column",alignItems:"center",mt:8},children:[r.jsx(Z,{component:"h1",variant:"h5",children:"Sign in"}),m&&r.jsx(j,{severity:"error",sx:{width:"100%",mb:2},children:m}),t&&r.jsx(j,{severity:"error",sx:{width:"100%",mb:2},children:typeof t.message=="string"?t.message:"An error occurred during login. Please try again."}),h&&r.jsx(j,{severity:"error",sx:{width:"100%",mb:2},children:typeof h.message=="string"?h.message:"An error occurred while verifying your session. Please log in again."}),r.jsx(k,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,id:"email",label:"Email Address",name:"email",autoComplete:"email",autoFocus:!0,value:o,onChange:a=>c(a.target.value)}),r.jsx(k,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Password",type:l?"text":"password",id:"password",autoComplete:"current-password",value:n,onChange:a=>d(a.target.value),InputProps:{endAdornment:r.jsx(G,{position:"end",children:r.jsx(N,{onClick:()=>p(!l),edge:"end",children:l?r.jsx(q,{}):r.jsx(T,{})})})}}),r.jsx(H,{control:r.jsx(K,{value:"remember",color:"primary"}),label:"Remember me"}),r.jsx(I,{type:"button",fullWidth:!0,variant:"contained",color:"primary",onClick:D,disabled:f,sx:{mt:3,mb:2},children:f?r.jsxs(r.Fragment,{children:[r.jsx(E,{size:24,sx:{mr:1}}),"Signing in..."]}):"Sign in"}),r.jsx(I,{fullWidth:!0,variant:"text",sx:{mt:1},onClick:()=>console.log("Forgot password clicked"),children:"Forgot password?"})]})};export{me as default};
//# sourceMappingURL=Login-eQzyChB1.js.map
