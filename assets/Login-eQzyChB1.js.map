{"version":3,"file":"Login-eQzyChB1.js","sources":["../../src/Hooks/useAuth.jsx","../../node_modules/@mui/icons-material/Visibility.js","../../node_modules/@mui/icons-material/VisibilityOff.js","../../src/pages/Login.jsx"],"sourcesContent":["import { useState } from 'react';\r\nimport axios from 'axios';\r\nimport { useDispatch } from 'react-redux';\r\nimport { loginSuccess } from 'store/slice/authSlice';\r\n\r\nexport const useAuth = () => {\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(null);\r\n  const [data, setData] = useState(null);\r\n  const dispatch = useDispatch();\r\n\r\n  const login = async (email, password) => {\r\n    setLoading(true);\r\n    setError(null);\r\n\r\n    try {\r\n      const emailTrim = email.toLowerCase().trim();\r\n      const response = await axios.post(import.meta.env.VITE_API_URL_AUTH, {\r\n        email:emailTrim,\r\n        password,\r\n      }, {\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        maxBodyLength: Infinity,\r\n      });\r\n\r\n      const { token, user } = response.data;\r\n\r\n      // Dispatch loginSuccess to update Redux state and save token in localStorage\r\n      dispatch(loginSuccess({ token, user }));\r\n\r\n      // Store both data and status in the state for further usage in the component\r\n      setData({ status: response.status, data: response.data });\r\n    } catch (err) {\r\n      setError(err.response ? err.response.data : err.message);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return { login, loading, error, data };\r\n};\r\n","\"use strict\";\n\"use client\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar _createSvgIcon = _interopRequireDefault(require(\"./utils/createSvgIcon\"));\nvar _jsxRuntime = require(\"react/jsx-runtime\");\nvar _default = exports.default = (0, _createSvgIcon.default)( /*#__PURE__*/(0, _jsxRuntime.jsx)(\"path\", {\n  d: \"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3\"\n}), 'Visibility');","\"use strict\";\n\"use client\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar _createSvgIcon = _interopRequireDefault(require(\"./utils/createSvgIcon\"));\nvar _jsxRuntime = require(\"react/jsx-runtime\");\nvar _default = exports.default = (0, _createSvgIcon.default)( /*#__PURE__*/(0, _jsxRuntime.jsx)(\"path\", {\n  d: \"M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7M2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2m4.31-.78 3.15 3.15.02-.16c0-1.66-1.34-3-3-3z\"\n}), 'VisibilityOff');","import React, { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport {\r\n  Container,\r\n  TextField,\r\n  Checkbox,\r\n  FormControlLabel,\r\n  IconButton,\r\n  InputAdornment,\r\n  Button,\r\n  CircularProgress,\r\n  Typography,\r\n  Alert,\r\n} from '@mui/material';\r\nimport Visibility from '@mui/icons-material/Visibility';\r\nimport VisibilityOff from '@mui/icons-material/VisibilityOff';\r\nimport { useAuth } from '../Hooks/index.mjs'; // Import the custom useAuth hook\r\nimport { useVerifyToken } from '../Hooks/useVerifyToken'; // Import the useVerifyToken hook\r\nimport { useDispatch } from 'react-redux';\r\nimport {SetFormDataLogin} from \"../store/slice/questionnaireSlice\"\r\n\r\nconst Login = () => {\r\n  const [email, setEmail] = useState('');\r\n  const [password, setPassword] = useState('');\r\n  const [showPassword, setShowPassword] = useState(false);\r\n  const [validationError, setValidationError] = useState('');\r\n  const { login, loading, error, data } = useAuth();\r\n  const navigate = useNavigate();\r\n  const dispatch = useDispatch();\r\n  // Use the custom useVerifyToken hook to verify token on component mount\r\n  const { loading: verifyingToken, error: verifyError,success:verifySucces ,userRole} = useVerifyToken();\r\n\r\n  const handleSubmit = () => {\r\n    setValidationError('');\r\n\r\n    if (!email || !password) {\r\n      setValidationError('Please fill in all required fields.');\r\n      return;\r\n    }\r\n\r\n    const emailPattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$/;\r\n    if (!emailPattern.test(email)) {\r\n      setValidationError('Please enter a valid email address.');\r\n      return;\r\n    }\r\n\r\n    login(email, password);\r\n  };\r\n\r\n  // Handle successful login by redirecting to the dashboard\r\n  useEffect(() => {\r\n    \r\n    if (data && data.status === 200) {\r\n     \r\n     \r\n      let dataObj={};\r\n      try{\r\n       \r\n        if (typeof data?.data?.form === 'string') {\r\n\r\n          dataObj = JSON.parse(data?.data?.form);\r\n      } else if (typeof data?.data?.form === 'object') {\r\n      \r\n          dataObj = data?.data?.form; // If it's already an object, use it directly\r\n      } else {\r\n          console.error(\"Invalid form_data:\", data?.data?.form);\r\n          //return; // Exit if form_data is neither a string nor an object\r\n      }\r\n\r\n\r\n      \r\n      dispatch(SetFormDataLogin({ data: dataObj }));\r\n    }\r\n    catch(err){\r\n      console.error(\"there is non data\",err);\r\n      \r\n      \r\n    }\r\n      //navigate('/dashboard'); // Redirect to /dashboard on successful login\r\n    } else if (data) {\r\n      setValidationError('Login failed. Please check your credentials.');\r\n    }\r\n  }, [data, navigate]);\r\n\r\n  useEffect(() => {\r\n    console.log(\"state:\",userRole.state)\r\n    if(verifySucces  ){\r\n    \r\n      if(userRole.role === \"1\" ){\r\n        navigate('/dashboard'); \r\n      }\r\n      else{\r\n        if(userRole.state ===\"0\"){\r\n            navigate('/profile'); \r\n        }\r\n        else{\r\n          //go to page tell u have to wait\r\n          navigate('/profile'); \r\n        }\r\n\r\n        \r\n      }\r\n      //\r\n    }\r\n    else{\r\n      //setValidationError('You do not have permission.');\r\n    }\r\n  }, [verifySucces]);\r\n  \r\n  // Show a loading spinner while verifying the token\r\n  if (verifyingToken) {\r\n    return <CircularProgress sx={{ mt: 8 }} />;\r\n  }\r\n\r\n  return (\r\n    <Container\r\n      component=\"main\"\r\n      maxWidth=\"xs\"\r\n      sx={{ display: 'flex', flexDirection: 'column', alignItems: 'center', mt: 8 }}\r\n    >\r\n      <Typography component=\"h1\" variant=\"h5\">\r\n        Sign in\r\n      </Typography>\r\n\r\n      {validationError && (\r\n        <Alert severity=\"error\" sx={{ width: '100%', mb: 2 }}>\r\n          {validationError}\r\n        </Alert>\r\n      )}\r\n      {error && (\r\n  <Alert severity=\"error\" sx={{ width: '100%', mb: 2 }}>\r\n    {typeof error.message === 'string' ? error.message : 'An error occurred during login. Please try again.'}\r\n  </Alert>\r\n)}\r\n{verifyError && (\r\n  <Alert severity=\"error\" sx={{ width: '100%', mb: 2 }}>\r\n    {typeof verifyError.message === 'string' ? verifyError.message : 'An error occurred while verifying your session. Please log in again.'}\r\n  </Alert>\r\n)}\r\n\r\n\r\n      <TextField\r\n        variant=\"outlined\"\r\n        margin=\"normal\"\r\n        required\r\n        fullWidth\r\n        id=\"email\"\r\n        label=\"Email Address\"\r\n        name=\"email\"\r\n        autoComplete=\"email\"\r\n        autoFocus\r\n        value={email}\r\n        onChange={(e) => setEmail(e.target.value)}\r\n      />\r\n\r\n      <TextField\r\n        variant=\"outlined\"\r\n        margin=\"normal\"\r\n        required\r\n        fullWidth\r\n        name=\"password\"\r\n        label=\"Password\"\r\n        type={showPassword ? 'text' : 'password'}\r\n        id=\"password\"\r\n        autoComplete=\"current-password\"\r\n        value={password}\r\n        onChange={(e) => setPassword(e.target.value)}\r\n        InputProps={{\r\n          endAdornment: (\r\n            <InputAdornment position=\"end\">\r\n              <IconButton\r\n                onClick={() => setShowPassword(!showPassword)}\r\n                edge=\"end\"\r\n              >\r\n                {showPassword ? <VisibilityOff /> : <Visibility />}\r\n              </IconButton>\r\n            </InputAdornment>\r\n          ),\r\n        }}\r\n      />\r\n\r\n      <FormControlLabel\r\n        control={<Checkbox value=\"remember\" color=\"primary\" />}\r\n        label=\"Remember me\"\r\n      />\r\n\r\n      <Button\r\n        type=\"button\"\r\n        fullWidth\r\n        variant=\"contained\"\r\n        color=\"primary\"\r\n        onClick={handleSubmit}\r\n        disabled={loading}\r\n        sx={{ mt: 3, mb: 2 }}\r\n      >\r\n        {loading ? (\r\n          <>\r\n            <CircularProgress size={24} sx={{ mr: 1 }} />\r\n            Signing in...\r\n          </>\r\n        ) : (\r\n          'Sign in'\r\n        )}\r\n      </Button>\r\n\r\n      <Button\r\n        fullWidth\r\n        variant=\"text\"\r\n        sx={{ mt: 1 }}\r\n        onClick={() => console.log('Forgot password clicked')}\r\n      >\r\n        Forgot password?\r\n      </Button>\r\n    </Container>\r\n  );\r\n};\r\n\r\nexport default Login;\r\n"],"names":["useAuth","loading","setLoading","useState","error","setError","data","setData","dispatch","useDispatch","email","password","emailTrim","response","axios","token","user","loginSuccess","err","_interopRequireDefault","require$$0","Visibility","default_1","_createSvgIcon","require$$1","_jsxRuntime","require$$2","VisibilityOff","Login","setEmail","setPassword","showPassword","setShowPassword","validationError","setValidationError","login","navigate","useNavigate","verifyingToken","verifyError","verifySucces","userRole","useVerifyToken","handleSubmit","useEffect","dataObj","_a","_b","_c","_d","_e","SetFormDataLogin","CircularProgress","jsxs","Container","jsx","Typography","Alert","TextField","e","InputAdornment","IconButton","FormControlLabel","Checkbox","Button","Fragment"],"mappings":"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","x_google_ignoreList":[1,2]}